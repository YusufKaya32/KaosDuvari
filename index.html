<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaos Duvarƒ± - ONLINE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* Tasarƒ±m kodlarƒ± aynƒ± (√ñnceki v4.0 ile aynƒ± stil) */
        body { background-color: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; overflow: hidden; position: relative; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 30px 30px; }
        h1.baslik { text-align: center; color: #555; margin-top: 50px; font-size: 2.5rem; pointer-events: none; user-select: none; opacity: 0.5; }
        .mesaj-kutusu { position: absolute; background: linear-gradient(145deg, #2d3436, #000); border-radius: 20px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px solid #444; width: fit-content; max-width: 80vw; min-width: 160px; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer; }
        .mesaj-kutusu:hover { z-index: 999999 !important; transform: scale(1.05); box-shadow: 0 0 60px rgba(255, 255, 255, 0.3); }
        .mesaj-metni { font-size: 16px; font-weight: bold; text-align: center; word-wrap: break-word; word-break: break-word; width: 100%; line-height: 1.2; margin-bottom: 15px; flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .butonlar { display: flex; gap: 10px; width: 100%; justify-content: center; flex-shrink: 0; z-index: 5; }
        button { border: none; padding: 10px 0; width: 45%; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.1s; }
        button:active { transform: scale(0.9); }
        .btn-like { background-color: #00b894; color: white; }
        .btn-dislike { background-color: #ff4757; color: white; }
        
        /* Renk Sƒ±nƒ±flarƒ± */
        .seviye-orta { background: linear-gradient(145deg, #0984e3, #001f3f); border-color: #74b9ff; }
        .seviye-yuksek { background: linear-gradient(145deg, #6c5ce7, #2d006b); border-color: #a29bfe; }
        .seviye-godzilla { background: linear-gradient(145deg, #d63031, #630000); border-color: #ff7675; }
        .lider { background: linear-gradient(145deg, #f1c40f, #b7950b) !important; border: 4px solid white !important; box-shadow: 0 0 60px rgba(241, 196, 15, 0.9); z-index: 1000; }
        .kral-taci { position: absolute; top: -55px; font-size: 50px; display: none; filter: drop-shadow(0 0 10px gold); animation: zipla 1s infinite alternate; }
        .lider .kral-taci { display: block; }
        @keyframes zipla { from { transform: translateY(0); } to { transform: translateY(-15px); } }
        
        #kontrol-paneli { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 400px; background-color: rgba(30, 30, 30, 0.95); padding: 15px; border-radius: 50px; display: flex; gap: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 2px solid #555; z-index: 2147483647; backdrop-filter: blur(10px); }
        input[type="text"] { flex: 1; padding: 12px 20px; border-radius: 30px; border: none; outline: none; background-color: #333; color: white; font-size: 16px; }
        #gonderBtn { background-color: #6c5ce7; color: white; padding: 0 25px; border-radius: 30px; }
    </style>
</head>
<body>

    <h1 class="baslik">KAOS DUVARI (ONLINE)</h1>
    <div id="duvar"></div>

    <div id="kontrol-paneli">
        <input type="text" id="mesajInput" placeholder="Mesajƒ±n t√ºm d√ºnyada g√∂r√ºnecek..." onkeypress="enterBasildi(event)">
        <button id="gonderBtn" onclick="mesajGonder()">Yolla üöÄ</button>
    </div>

    <script>
        // --- 1. AYARLAR KISMI ---
        // Firebase konsolundan aldƒ±ƒüƒ±n "firebaseConfig" kodunu a≈üaƒüƒ±ya yapƒ±≈ütƒ±r:
        const firebaseConfig = {
            apiKey: "AIzaSyCxvgIA4nXphM0Dazyfa-1nB1lFp-g5lhw",
  authDomain: "kaos-duvari.firebaseapp.com",
  projectId: "kaos-duvari",
  storageBucket: "kaos-duvari.firebasestorage.app",
  messagingSenderId: "1082355781966",
  appId: "1:1082355781966:web:d519924f3a5d0e121e8e1f",
  measurementId: "G-L9Y4MRN1K8"
            // BURAYA KENDƒ∞ KODLARINI YAPI≈ûTIRACAKSIN (apiKey, authDomain vs...)
            // √ñrnek:
            // apiKey: "AIzaSyD......",
            // authDomain: "kaos-duvari.firebaseapp.com",
            // ...
        };

        // Firebase'i Ba≈ülat
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const mesajlarRef = db.ref('mesajlar');

        // --- 2. VERƒ∞TABANI Dƒ∞NLEYƒ∞Cƒ∞LERƒ∞ (HERKES ƒ∞√áƒ∞N √áALI≈ûIR) ---
        
        // Yeni mesaj gelince
        mesajlarRef.on('child_added', (snapshot) => {
            const data = snapshot.val();
            ekranaMesajCiz(snapshot.key, data);
        });

        // Mesaj deƒüi≈üince (biri like atƒ±nca)
        mesajlarRef.on('child_changed', (snapshot) => {
            const data = snapshot.val();
            mesajGuncelle(snapshot.key, data.boyut);
        });

        // Mesaj silinince
        mesajlarRef.on('child_removed', (snapshot) => {
            const kutu = document.getElementById(snapshot.key);
            if (kutu) kutu.remove();
            kralGuncelle();
        });

        // --- 3. FONKSƒ∞YONLAR ---

        function mesajGonder() {
            const input = document.getElementById("mesajInput");
            const metin = input.value.trim();
            if (metin === "") return;

            // Rastgele Konum Belirle ve Veritabanƒ±na Kaydet
            const randomX = Math.floor(Math.random() * (window.innerWidth - 300));
            const randomY = Math.floor(Math.random() * (window.innerHeight * 0.6)) + 50;

            // Veritabanƒ±na "push" ediyoruz (Yerelde √ßizmiyoruz, listener √ßizecek)
            mesajlarRef.push({
                metin: metin,
                boyut: 16, // Ba≈ülangƒ±√ß boyutu
                x: randomX,
                y: randomY
            });

            input.value = "";
        }

        function enterBasildi(event) { if (event.key === "Enter") mesajGonder(); }

        // Ekrana √áizme Fonksiyonu
        function ekranaMesajCiz(key, data) {
            const duvar = document.getElementById("duvar");
            
            const yeniKutu = document.createElement("div");
            yeniKutu.className = "mesaj-kutusu";
            yeniKutu.id = key;
            yeniKutu.style.left = data.x + "px";
            yeniKutu.style.top = data.y + "px";

            yeniKutu.innerHTML = `
                <div class="kral-taci">üëë</div>
                <span class="mesaj-metni" id="text-${key}" style="font-size: ${data.boyut}px;">${data.metin}</span>
                <div class="butonlar">
                    <button class="btn-like" onclick="boyutDegistir('${key}', 8)">üëç</button>
                    <button class="btn-dislike" onclick="boyutDegistir('${key}', -8)">üëé</button>
                </div>
            `;

            duvar.appendChild(yeniKutu);
            mesajGuncelle(key, data.boyut); // Renkleri ayarla
        }

        // Like/Dislike Veritabanƒ±na Yazar
        function boyutDegistir(key, miktar) {
            // √ñnce mevcut boyutu √∂ƒürenmek i√ßin veritabanƒ±na soruyoruz (Transaction)
            mesajlarRef.child(key).child('boyut').transaction((currentBoyut) => {
                return (currentBoyut || 16) + miktar;
            });
        }

        // G√∂rsel G√ºncelleme
        function mesajGuncelle(key, yeniBoyut) {
            const kutu = document.getElementById(key);
            if (!kutu) return;
            const metin = document.getElementById("text-" + key);

            // √ñL√úM (Veritabanƒ±ndan sil)
            if (yeniBoyut <= 8) {
                // Sadece veritabanƒ±ndan sil komutu yolla, listener herkesin ekranƒ±ndan silecek
                mesajlarRef.child(key).remove(); 
                return;
            }

            metin.style.fontSize = yeniBoyut + "px";

            // Renkler
            kutu.classList.remove("seviye-orta", "seviye-yuksek", "seviye-godzilla");
            if (yeniBoyut > 25 && yeniBoyut <= 50) kutu.classList.add("seviye-orta");
            else if (yeniBoyut > 50 && yeniBoyut <= 90) kutu.classList.add("seviye-yuksek");
            else if (yeniBoyut > 90) kutu.classList.add("seviye-godzilla");

            ekranSiniriniKoru(kutu);
            kralGuncelle();
        }

        function ekranSiniriniKoru(kutu) {
            const rect = kutu.getBoundingClientRect();
            const guvenliAltSinir = window.innerHeight - 130; 
            if (rect.bottom > guvenliAltSinir) {
                const tasmaMiktari = rect.bottom - guvenliAltSinir;
                const mevcutTop = parseInt(kutu.style.top);
                kutu.style.top = (mevcutTop - tasmaMiktari) + "px";
            }
        }

        function kralGuncelle() {
            const mesajlar = document.getElementsByClassName("mesaj-kutusu");
            let enBuyukBoyut = 0;
            let kralOlanKutu = null;
            for (let kutu of mesajlar) {
                kutu.classList.remove("lider");
                let boyut = parseInt(kutu.querySelector(".mesaj-metni").style.fontSize);
                if (boyut > enBuyukBoyut) { enBuyukBoyut = boyut; kralOlanKutu = kutu; }
            }
            if (kralOlanKutu) kralOlanKutu.classList.add("lider");
        }
    </script>
</body>
</html>
